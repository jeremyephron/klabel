<!DOCTYPE html>
<html>
<head>
	<title>Labeling Function Viz</title>
<style>
	body {
		font-family: Helvetica, Arial, sans-seris;
		font-size: 10pt;
		color: #808080;
		background: #ffffff;
	}

	body a {
		color: #d0d0d0;
	}

	.bold_text {
		font-weight: bold;
	}

</style>

<script src="kmath.js"></script>
<script src="klfviz.js"></script>

<script>

	var main_canvas_id = 'main_canvas';   // this is the DOM canvas element 
	var preview_div_id = 'preview_div';   // this is the DOM canvas element 
	var lfviz = new LFViz;
	
	// data passed to viz
	var num_rows = 1024;
	var num_lf = 5;
	var matrix = [];
	var datapoints = [];
	var highlight = [];

	var lf_names = [];
	for (var i=0; i<num_lf; i++) {
		lf_names.push("LF" + i);
	}

	function compute_highlight_mask(lf_function, criteria) {

		highlight = [];

		if (lf_function == -3) {
			for (var i=0; i<num_rows; i++) {
				highlight[i] = true;
			}

		} else if (lf_function == -2) {  // all LFs match criteria

			for (var i=0; i<num_rows; i++) {
				var idx = i*num_lf;
				highlight[i] = true;
				for (var j=0; j<num_lf; j++) {
					if (matrix[idx + j] != criteria)
						highlight[i] = false;
				}
			}

		} else if (lf_function == -1) { // any LFs match criteria

			for (var i=0; i<num_rows; i++) {
				var idx = i*num_lf;
				highlight[i] = false;
				for (var j=0; j<num_lf; j++) {
					if (matrix[idx + j] == criteria)
						highlight[i] = true;
				}
			}

		} else { // specific LFs match criteria

			for (var i=0; i<num_rows; i++) {
				var idx = i*num_lf;
				if (matrix[idx + lf_function] == criteria)
					highlight[i] = true;
				else
					highlight[i] = false;
			}

		}

	}

	function reset_highlight_mask() {
		compute_highlight_mask(-3, 0);
	}

	function create_dummy_lf_data(num_rows, num_lf, matrix) {
		for (var i = 0; i<num_rows; i++) {
			for (var j=0; j<num_lf; j++) {

				var x = Math.random();

				if (x < 1.0/5.0)
					matrix[i*num_lf + j] = 1;
				else if (x < 2.0/5.0)
					matrix[i*num_lf + j] = -1;
				else
					matrix[i*num_lf + j] = 0;
			}
		}		
	}

	function handle_create_dummy_text() {
		matrix = [];
		datapoints = [];
		create_dummy_lf_data(num_rows, num_lf, matrix);

		for (var i=0; i<num_rows; i++) {
			datapoints.push("This is the text string associated with datapoint " + i + " that the labeling functions were executed on.  LFViz will display the text on hover.");
		}

		reset_highlight_mask();
		lfviz.load_data(num_rows, num_lf, matrix, LFViz.DATAPOINT_TYPE_TEXT, datapoints, highlight);
	}

	function handle_create_dummy_images() {
		matrix = [];
		datapoints = [];
		create_dummy_lf_data(num_rows, num_lf, matrix);

		for (var i=0; i<num_rows; i++) {
			datapoints.push("media/image_0" + (i % 8) + ".jpg");
		}

		reset_highlight_mask();
		lfviz.load_data(num_rows, num_lf, matrix, LFViz.DATAPOINT_TYPE_IMAGE, datapoints, highlight);
	}

	function handle_clear_highlight() {
		reset_highlight_mask();
		lfviz.set_highlight_mask(highlight);
	}

	function handle_make_highlight() {

		var lf_select = 0;
		var lf_value = 1;
		var select_lf_box = document.getElementById("select_lf");
		var select_value_box = document.getElementById("select_lf_status");

		if (select_lf_box.value == "lf_all")
			lf_select = -2;
		else if (select_lf_box.value == "lf_any")
			lf_select = -1;
		else {
			for (var i=0; i<num_lf; i++) {
				if (select_lf_box.value == ("LF" + i)) {
					lf_select = i;
					break;
				}
			}
		}
		
		if (select_value_box.value == "positive")
			lf_value = 1;
		else if (select_value_box.value == "negative")
			lf_value = -1;
		else
			lf_value = 0;

		compute_highlight_mask(lf_select, lf_value); 
		lfviz.set_highlight_mask(highlight);
	}

	function handle_onload() {

		var select_box = document.getElementById("select_lf");
		for (var i=0; i<num_lf; i++) {
			var option = document.createElement("option");
			option.text = "LF" + i;
			select_box.add(option);
		}

		var main_canvas = document.getElementById(main_canvas_id);
		var preview_div = document.getElementById(preview_div_id);

		lfviz.init(main_canvas, preview_div);
		handle_create_dummy_images();  // populate viewer with dummy image data
	}

</script>
</head>

<body onload="handle_onload()">

<div id="labeled_div">
	<canvas id="main_canvas" width="960" height="500" style="border: 1px solid #c0c0c0; display: block; float: left;" ></canvas>
	<div id="preview_div" style="padding-left: 5px; width: 256px; height: 500px; float: left;">&nbsp;</div>
</div>

<div style="clear: both;">
	<button id="dummy_text_button" type="button" onclick="handle_create_dummy_text()">Create Dummy Text Data</button>
	<button id="dummy_image_button" type="button" onclick="handle_create_dummy_images()">Create Dummy Image Data</button>
</div>

<div>Highlight data points where 
	<select id="select_lf">
       <option value="lf_all">all labels funcs</option>
       <option value="lf_any">any labeling func</option>
    </select>
    is
    <select id="select_lf_status">
       <option value="positive">positive</option>
       <option value="negative">negative</option>
       <option value="abstain">abstains</option>
    </select>
    .

    <button id="make_selection" type="button" onclick="handle_make_highlight()">Go!</button>
    <button id="make_selection" type="button" onclick="handle_clear_highlight()">Clear</button>

</div>

<p>
<div>Green - positive vote</div>
<div>Red - positive vote</div>
<div>Gray - abstain</div>
</p>
<p>Hover over a row to see the data point.</p>

</body>
</html>